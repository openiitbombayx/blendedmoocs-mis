{% load staticfiles %}
{% block header %}
{% endblock %}
{% block body_block %}
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <script src="{% static 'js/bootstrap.min.js'%}"></script>
  <style>
	
	table.data,table.data td,table.data th {
	    border: 1px solid black;
	    border-collapse: collapse;
	    text-align: center;
	}

	table.data {
	    width: 100%;
	}
	table.data tr:nth-child(odd) {
	   background-color: #ccc;
	}
	table.data tr:hover {
		  background-color: #ffff99;
		}
	table.data th {
	    height: 35px;
	    color: #F7691F
	}
	table.data tr {
	    height: 28px;
	}
	table.head, td, th, tr {
		border: 0px solid black;
		border-collapse: collapse;		
	}
	table.head {
	    width: 100%;
	    background-color: ;
	}
</style>
   
 <!-- Scripts ----------------------------------------------------------- -->

<script type='text/javascript' src='https://code.jquery.com/jquery-1.11.0.min.js'></script>
<script src="http://code.highcharts.com/highcharts.js"></script>
<script src="http://code.highcharts.com/modules/data.js"></script>
<script src="http://code.highcharts.com/modules/drilldown.js"></script>
<script src="http://code.highcharts.com/modules/exporting.js"></script>
<script type='text/javascript'>
$(document).ready(function () {

function exportTableToCSV($table, filename) {
var $headers = $table.find('tr:has(th)')
,$rows = $table.find('tr:has(td)')
// Temporary delimiter characters unlikely to be typed by keyboard
// This is to avoid accidentally splitting the actual contents
,tmpColDelim = String.fromCharCode(11) // vertical tab character
,tmpRowDelim = String.fromCharCode(0) // null character
// actual delimiter characters for CSV format
,colDelim = '","'
,rowDelim = '"\r\n"';
// Grab text from table into CSV formatted string
var csv = '"';
csv += formatRows($headers.map(grabRow));
csv += rowDelim;
csv += formatRows($rows.map(grabRow)) + '"';
// Data URI
var csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);
$(this)
.attr({
'download': filename
,'href': csvData
//,'target' : '_blank' //if you want it to open in a new window
});
//------------------------------------------------------------
// Helper Functions
//------------------------------------------------------------
// Format the output so it has the appropriate delimiters
function formatRows(rows){
return rows.get().join(tmpRowDelim)
.split(tmpRowDelim).join(rowDelim)
.split(tmpColDelim).join(colDelim);
}
// Grab and format a row from the table
function grabRow(i,row){
var $row = $(row);
//for some reason $cols = $row.find('td') || $row.find('th') won't work...
var $cols = $row.find('td');
if(!$cols.length) $cols = $row.find('th');
return $cols.map(grabCol)
.get().join(tmpColDelim);
}
// Grab and format a column from the table
function grabCol(j,col){
var $col = $(col),
$text = $col.text();
return $text.replace('"','""'); // escape double quotes
}
}
// This must be a hyperlink

   $(".export").on('click', function (event) {
        // CSV
        exportTableToCSV.apply(this, [$('#dvData>table'), '{{report_name}}.csv']);
        
        // IF CSV, don't do event.preventDefault() or return false
        // We actually need this to be a typical hyperlink
    });
});



$(function () {
    $('#container1').highcharts({
        chart: {
            type: 'column'
        },
        title: {
            text: 'Blended Vs Non-Blended'
        },
        xAxis: {
            categories: [

                          {% for  title in heading  %}
                             {% if forloop.counter == 4 or forloop.counter == 5 or forloop.counter == 6 %}
                             
                              "{{title}}",
                             
                            {%  endif %}
  
                         {% endfor %}


                        ]
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Participation'
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: (Highcharts.theme && Highcharts.theme.textColor) || 'gray'
                }
            }
        },
        legend: {
            align: 'right',
            x: -30,
            verticalAlign: 'top',
            y: 25,
            floating: true,
            backgroundColor: (Highcharts.theme && Highcharts.theme.background2) || 'white',
            borderColor: '#CCC',
            borderWidth: 1,
            shadow: false
        },
        tooltip: {
            headerFormat: '<b>{point.x}</b><br/>',
            pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true,
                    color: (Highcharts.theme && Highcharts.theme.dataLabelsColor) || 'white',
                    style: {
                        textShadow: '0 0 3px black'
                    }
                }
            }
        },
        series: [{
           name: {% for  row in reports %}
                          {% if forloop.counter == 2 %}
                             
                            "{{ row.2 }}"
                          {%  endif %}

                      {% endfor %},

            data: [
                       {% for  row in reports %}
                          {% if forloop.counter == 2 %}
                             
                            {{ row.3 }},{{ row.4 }},{{ row.5 }}
                          {%  endif %}

                      {% endfor %}

                  ]
        }, {
            name: {% for  row in reports %}
                          {% if forloop.counter == 1 %}
                             
                            "{{ row.2 }}"
                          {%  endif %}

                      {% endfor %},
            data: [
                      {% for  row in reports %}
                          {% if forloop.counter == 1 %}
                             
                            {{ row.3 }},{{ row.4 }},{{ row.5 }}
                          {%  endif %}

                      {% endfor %}
                  ]
  
        }
       ]
    });
});


$(function () {
    $('#container2').highcharts({
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Participation within Blended'
        },
        xAxis: {
            categories: [ {% for  row in reports %}
                          {% for col in row.res %}
                             {% if forloop.counter == 3 %}
                              "{{ col }}",
                             {% endif %}

                          {% endfor %}
                      {% endfor %}]
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total participation'
            }
        },
        legend: {
            reversed: true
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: [{
            name: 
                       {% for title in heading %}
                          {% if forloop.counter == 4 %}
                             
                            "{{ title }}"
                          {%  endif %}

                      {% endfor %},
            data: [
                      {% for  row in reports %}
                         {% for col in row.res %}
                           {% if forloop.counter == 4 %}
                            {{ col }},
                           {% endif %}
                         {% endfor %}
                      {% endfor %} 
                  ]
        }, {
            name: 
                      {% for title in heading %}
                          {% if forloop.counter == 5 %}      
                            "{{ title }}"
                          {%  endif %}
                      {% endfor %},
            data: [
                      {% for  row in reports %}
                         {% for col in row.res %}
                           {% if forloop.counter == 5 %}
                            {{ col }},
                           {% endif %}
                         {% endfor %}
                      {% endfor %} 
                  ]
        }
        ]
    });
});

</script>


<header><center><h2><font color="#F7691F"><u>{{report_name}}</u></font></h2></center></header>
<br><table style="width:90%" cellspacing="5" cellpadding="5" align="center"><tr><td align="left"><a href="#" class="export">Download CSV</a></td><td align="right"><a href="/instructor_course_report/{{course}}">Reports Home</a></td></tr></table>

{% if flag == 2 %}

<div id="container1" style="min-width: 310px; height: 500px; max-width: 500px; margin: 0 auto"></div>

{% endif %}

{% if flag == 3 %}
<div id="container2" style="min-width: 310px; max-width: 2000px; height: 600px; margin: 0 auto"></div>
{% endif %}

<div id="dvData">


<table cellspacing="5" cellpadding="5" border="1" style="width:90%" align="center" class="table table-hover" >
<tr>
{% for title in heading %}
<th>{{title}}
</th>
{% endfor %}
</tr>
 {% if usertype == -2 %}
{% for row in reports %}
<tr>
{% for col in row  %}
       <td>{{col}}</td>
{% endfor %}
</tr>
{% endfor %}
{% else %}
{% for row in reports %}
<tr>
 {% if reptype == 'C' %}
 
{% for col in row.res  %}
 {% if forloop.counter == 4 %}
        <td><a href="/instructoradmin/2_2_C/{{course}}/{{row.instituteid}}">{{col}}</a></td>
 {% else %}
  <td> {{col}} </td>
{% endif %}
{% endfor %}
{% else %}  
{% for col in row  %}
    {% if reptype == 'A' and forloop.counter == 3 %}
           <td><a href="/instructoradmin/2_2_A/{{course}}/0">{{col}}</a></td>
    {% elif reptype == 'B' and forloop.counter == 4 and forloop.parentloop.counter == 1 %}
            <td><a href="/instructoradmin/2_2_B/{{course}}/-1">{{col}}</a></td>
     {% elif reptype == 'B' and forloop.counter == 4 and forloop.parentloop.counter == 2 %}
            <td><a href="/instructoradmin/2_2_B/{{course}}/1">{{col}}</a></td>
      {% else %}
            <td>{{col}}</td>
      {% endif %}

{% endfor %}
{% endif %}
</tr>

{% endfor %}
{% endif %}
</table>

</div>
{% endblock %}
